(this["webpackJsonpreddit-clone"]=this["webpackJsonpreddit-clone"]||[]).push([[0],{49:function(e,t,r){},55:function(e,t,r){},57:function(e,t,r){},58:function(e,t,r){},59:function(e,t,r){"use strict";r.r(t);var n=r(2),c=r.n(n),s=r(28),a=r.n(s),i=r(12),u=r.n(i),o=r(18),d=r(20),l=r(17),j=r(35);j.a.initializeApp({apiKey:"AIzaSyBydRiEoZE1fbjHXOEsq7MoIOn6IqXRsZ4",authDomain:"reddit-clone-cef6c.firebaseapp.com",projectId:"reddit-clone-cef6c",storageBucket:"reddit-clone-cef6c.appspot.com",messagingSenderId:"268435638413",appId:"1:268435638413:web:be2d494bf63b8ed16e7ac4"});var b=j.a,f=(r(49),r(3)),p=function(e){var t=e.user,r=e.children,c=Object(n.useState)(!1),s=Object(d.a)(c,2),a=s[0],i=s[1],j=function(){var e=Object(o.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.auth.GoogleAuthProvider,e.next=3,b.auth().signInWithPopup(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(o.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.auth().signOut();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(f.jsxs)("div",{children:[Object(f.jsxs)("nav",{className:"navbar navbar-dark bg-primary",children:[Object(f.jsx)(l.b,{className:"navbar-brand",to:"/",children:"Reddit clone"}),!t&&Object(f.jsx)("button",{onClick:j,className:"btn btn-secondary my-2 my-sm-0",children:"Login with Google"}),t&&Object(f.jsxs)("section",{className:"menu",children:[Object(f.jsxs)("div",{className:"menu__user-details",children:[Object(f.jsx)("img",{src:t.image,referrerPolicy:"no-referrer",onMouseOver:function(){return i(!0)},onMouseLeave:function(){return i(!1)}}),a&&Object(f.jsxs)("div",{className:"menu__tooltip",children:[Object(f.jsx)("span",{className:"arrow"}),t.name]})]}),Object(f.jsx)("button",{onClick:p,className:"btn btn-secondary my-2 my-sm-0",children:"Logout"})]})]}),Object(f.jsx)("main",{className:"container mt-3",children:r})]})},O=function(){return Object(f.jsx)("div",{children:Object(f.jsx)(l.b,{to:"/subreddits",children:"Subreddits"})})},m=function(e){return Object(f.jsxs)("div",{children:[Object(f.jsx)("h2",{className:"text-muted mb-5",children:"Subreddits"}),Object(f.jsx)("ul",{className:"list-group",children:e.subreddits.map((function(e){return Object(f.jsx)(l.b,{className:"text-info",to:"/r/".concat(e.name),children:Object(f.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.name,Object(f.jsx)("span",{})]})},e.id)}))})]})},h=r(38),x=r(41),v=r(16),g=function(e){var t=e.onCreatePost,r=Object(n.useState)(!1),c=Object(d.a)(r,2),s=c[0],a=c[1],i=Object(n.useState)({title:"",description:"",url:""}),u=Object(d.a)(i,2),o=u[0],l=u[1],j=function(e){return function(t){var r=t.target.value;"title"===e&&l(Object(v.a)(Object(v.a)({},o),{},{title:r})),"description"===e&&l(Object(v.a)(Object(v.a)({},o),{},{description:r})),"url"===e&&l(Object(v.a)(Object(v.a)({},o),{},{url:r}))}};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){return a(!s)},children:"Toggle form"}),s&&Object(f.jsxs)("form",{onSubmit:function(e){e.preventDefault();var r=o.title,n=o.description,c=o.url;r&&(n||c)&&(t(o),l({title:"",description:"",url:""}))},className:"mt-3",children:[Object(f.jsxs)("div",{className:"form-group",children:[Object(f.jsx)("label",{htmlFor:"title",children:"Title"}),Object(f.jsx)("input",{id:"title",required:!0,type:"text",value:o.title,onChange:j("title"),className:"form-control"})]}),Object(f.jsxs)("div",{className:"form-group",children:[Object(f.jsx)("label",{htmlFor:"description",children:"Description"}),Object(f.jsx)("textarea",{id:"description",rows:"4",value:o.description,onChange:j("description"),className:"form-control"})]}),Object(f.jsxs)("div",{className:"form-group",children:[Object(f.jsx)("label",{htmlFor:"url",children:"URL"}),Object(f.jsx)("input",{id:"url",type:"url",value:o.url,onChange:j("url"),className:"form-control"})]}),Object(f.jsx)("button",{className:"btn btn-info",children:"Create Post"})]})]})},N=r(8),_=r(19),S=b.firestore(),y=(r(55),function(e){var t=e.indexOf("?");if(-1!==t){var r=e.substring(0,t);return new RegExp(/(png|jpg|jpeg|gif)$/).test(r)}return new RegExp(/(png|jpg|jpeg|gif)$/).test(e)}),w=function(e){var t=e.user,r=Object(n.useState)([]),c=Object(d.a)(r,2),s=c[0],a=c[1],i=Object(n.useState)({}),l=Object(d.a)(i,2),j=l[0],p=l[1],O=Object(N.f)(),m=Object(_.c)((function(e){return e.subreddits.find((function(e){return e.name===O.name}))}));Object(n.useEffect)((function(){if(m){var e=S.collection("posts").where("subreddit_id","==",m.id).onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(Object(v.a)(Object(v.a)({},e.data()),{},{id:e.id}))})),a(t)}));return function(){e()}}}),[m]),Object(n.useEffect)(Object(o.a)(u.a.mark((function e(){var t,r,n,c,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.length){e.next=23;break}t=Object(x.a)(new Set(s.map((function(e){return e.user_id})))),r={},n=Object(h.a)(t),e.prev=4,n.s();case 6:if((c=n.n()).done){e.next=14;break}return a=c.value,e.next=10,S.collection("users").doc(a).get();case 10:i=e.sent,r[a]=i.data();case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:p(r);case 23:case"end":return e.stop()}}),e,null,[[4,16,19,22]])}))),[s]);var w=function(){var e=Object(o.a)(u.a.mark((function e(r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={title:r.title,description:r.description,url:r.url,user_id:t.id,subreddit_id:m.id,created_at:b.firestore.FieldValue.serverTimestamp(),updated_at:b.firestore.FieldValue.serverTimestamp()},e.next=3,S.collection("posts").add(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return console.log("users object: ",j),Object(f.jsxs)("div",{children:[Object(f.jsx)("h2",{className:"text-muted mb-5",children:O.name.toUpperCase()}),t?Object(f.jsx)(g,{onCreatePost:w}):Object(f.jsx)("span",{className:"text-muted",children:"Please log in to create a post"}),Object(f.jsx)("section",{className:"mt-5",children:s.map((function(e,t){return Object(f.jsx)("div",{className:"card mb-3",children:Object(f.jsxs)("div",{className:"card__flex g-0",children:[Object(f.jsx)("div",{className:"card__col-left",children:"^"}),Object(f.jsx)("div",{className:"card__col-right",children:Object(f.jsxs)("div",{className:"card-body pt-1",children:[Object(f.jsx)("img",{className:"userImg",src:j[e.user_id]?j[e.user_id].image:""}),Object(f.jsxs)("span",{className:"card__user",children:["Posted by ",j[e.user_id]?j[e.user_id].name:""]}),Object(f.jsx)("span",{className:"card__date",children:e.created_at.toDate().toLocaleString()}),Object(f.jsx)("h5",{className:"card-title mt-2",children:e.title}),Object(f.jsx)("p",{className:"card-text",children:e.description}),e.url&&y(e.url)&&Object(f.jsx)("img",{src:e.url}),e.url&&!y(e.url)&&Object(f.jsx)("a",{href:e.url,target:"_blank",children:e.url})]})})]})},e.id)}))})]})},E=function(e){return{type:"AUTH_SUCCESS",user:e}},k=[],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SUBREDDITS":return t.subreddits;default:return e}};r(56),r(57);var T=function(){var e=Object(_.c)((function(e){return e.auth.user})),t=Object(_.c)((function(e){return e.subreddits})),r=Object(_.b)();return Object(n.useEffect)((function(){b.auth().onAuthStateChanged(function(){var e=Object(o.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return n={id:t.uid,name:t.displayName,image:t.photoURL,created_at:b.firestore.FieldValue.serverTimestamp()},e.next=4,S.collection("users").doc(n.id).set(n);case 4:r(E(n)),e.next=8;break;case 7:r({type:"LOGOUT"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(n.useEffect)((function(){var e=S.collection("subreddits").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.data())})),r(function(e){return{type:"SET_SUBREDDITS",subreddits:e}}(t))}));return function(){e()}}),[]),Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(p,{user:e,children:Object(f.jsxs)(N.c,{children:[Object(f.jsx)(N.a,{exact:!0,path:"/",children:Object(f.jsx)(O,{})}),Object(f.jsx)(N.a,{path:"/subreddits",render:function(){return Object(f.jsx)(m,{subreddits:t})}}),Object(f.jsx)(N.a,{path:"/r/:name",children:Object(f.jsx)(w,{user:e})})]})})})},I=r(22),U=r(40),D={user:null},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTH_SUCCESS":return{user:t.user};case"LOGOUT":return{user:null};default:return e}},L=(r(58),Object(I.c)({auth:R,subreddits:C})),P=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||I.d,A=Object(I.e)(L,P(Object(I.a)(U.a)));a.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(_.a,{store:A,children:Object(f.jsx)(l.a,{basename:"/reddit-clone",children:Object(f.jsx)(T,{})})})}),document.getElementById("root"))}},[[59,1,2]]]);
//# sourceMappingURL=main.149a9b5d.chunk.js.map