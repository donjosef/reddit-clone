(this["webpackJsonpreddit-clone"]=this["webpackJsonpreddit-clone"]||[]).push([[0],{50:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),s=n(29),a=n.n(s),i=n(10),o=n.n(i),u=n(16),d=n(17),l=n(18),j=n(36);j.a.initializeApp({apiKey:"AIzaSyBydRiEoZE1fbjHXOEsq7MoIOn6IqXRsZ4",authDomain:"reddit-clone-cef6c.firebaseapp.com",projectId:"reddit-clone-cef6c",storageBucket:"reddit-clone-cef6c.appspot.com",messagingSenderId:"268435638413",appId:"1:268435638413:web:be2d494bf63b8ed16e7ac4"});var b=j.a,p=(n(50),n(3)),m=function(e){var t=e.user,n=e.children,c=Object(r.useState)(!1),s=Object(d.a)(c,2),a=s[0],i=s[1],j=function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.auth.GoogleAuthProvider,e.next=3,b.auth().signInWithPopup(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.auth().signOut();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{children:[Object(p.jsxs)("nav",{className:"navbar navbar-dark bg-primary",children:[Object(p.jsx)(l.b,{className:"navbar-brand",to:"/",children:"Reddit clone"}),!t&&Object(p.jsx)("button",{onClick:j,className:"btn btn-secondary my-2 my-sm-0",children:"Login with Google"}),t&&Object(p.jsxs)("section",{className:"menu",children:[Object(p.jsxs)("div",{className:"menu__user-details",children:[Object(p.jsx)("img",{src:t.image,referrerPolicy:"no-referrer",onMouseOver:function(){return i(!0)},onMouseLeave:function(){return i(!1)}}),a&&Object(p.jsxs)("div",{className:"menu__tooltip",children:[Object(p.jsx)("span",{className:"arrow"}),t.name]})]}),Object(p.jsx)("button",{onClick:m,className:"btn btn-secondary my-2 my-sm-0",children:"Logout"})]})]}),Object(p.jsx)("main",{className:"container mt-3",children:n})]})},f=function(){return Object(p.jsx)("div",{children:Object(p.jsx)(l.b,{to:"/subreddits",children:"Subreddits"})})},O=function(e){return Object(p.jsxs)("div",{children:[Object(p.jsx)("h2",{className:"text-muted mb-5",children:"Subreddits"}),Object(p.jsx)("ul",{className:"list-group",children:e.subreddits.map((function(e){return Object(p.jsx)(l.b,{className:"text-info",to:"/r/".concat(e.name),children:Object(p.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.name,Object(p.jsx)("span",{})]})},e.id)}))})]})},h=n(28),x=n(39),v=n(42),g=n(19),_=(n(56),function(e){var t=e.activePost,n=e.mode,r=e.isOpen,c=e.onOpenForm,s=e.onCloseForm,a=e.onCreatePost,i=e.onUpdatePost;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("button",{className:"btn btn-outline-primary",onClick:c,children:"Toggle form"}),r&&Object(p.jsx)("div",{className:"modal",children:Object(p.jsx)("div",{className:"modal-dialog",children:Object(p.jsxs)("div",{className:"modal-content",children:[Object(p.jsx)("div",{className:"modal-header",style:{display:"flex",justifyContent:"flex-end"},children:Object(p.jsx)("button",{type:"button",onClick:s,className:"btn btn-outline-primary","aria-label":"Close",children:"X"})}),Object(p.jsx)("div",{className:"modal-body",children:Object(p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),"create"===n&&e.target.title.value&&(e.target.description.value||e.target.url.value)&&(a({title:e.target.title.value,description:e.target.description.value,url:e.target.url.value}),e.target.reset()),"update"===n&&i({title:e.target.title.value,description:e.target.description.value,url:e.target.url.value})},className:"mt-3",children:[Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{htmlFor:"title",children:"Title"}),Object(p.jsx)("input",{id:"title",name:"title",required:!0,type:"text",defaultValue:t.title,className:"form-control"})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{htmlFor:"description",children:"Description"}),Object(p.jsx)("textarea",{id:"description",name:"description",rows:"4",defaultValue:t.description,className:"form-control"})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{htmlFor:"url",children:"URL"}),Object(p.jsx)("input",{id:"url",name:"url",type:"url",defaultValue:t.url,className:"form-control"})]}),Object(p.jsx)("button",{className:"btn btn-info",children:n.toUpperCase()})]})})]})})})]})}),N=(n(57),function(e){return e||""}),y=function(e){var t=e.indexOf("?");if(-1!==t){var n=e.substring(0,t);return new RegExp(/(png|jpg|jpeg|gif)$/).test(n)}return new RegExp(/(png|jpg|jpeg|gif)$/).test(e)},w=function(e){var t=e.post,n=e.vote,c=e.onVotePost,s=e.onDeletePost,a=e.user,i=e.users,o=e.onOpenForm,u=Object(r.useState)(!1),l=Object(d.a)(u,2),j=l[0],b=l[1];return Object(p.jsx)("div",{className:"card mb-3",children:Object(p.jsxs)("div",{className:"card__flex g-0",children:[Object(p.jsxs)("div",{className:"card__col-left",children:[Object(p.jsx)("span",{onClick:function(){return c(t.id,"add")},className:"card__vote-up",children:Object(p.jsx)("img",{src:"https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-arrow-up-b-256.png"})}),Object(p.jsx)("span",{className:"card__vote",children:n}),Object(p.jsx)("span",{onClick:function(){return c(t.id,"delete")},className:"card__vote-down",children:Object(p.jsx)("img",{src:"https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-arrow-down-b-256.png"})})]}),Object(p.jsx)("div",{className:"card__col-right",children:Object(p.jsxs)("div",{className:"card-body pt-1",children:[Object(p.jsxs)("div",{className:"card__header",children:[Object(p.jsx)("img",{className:"userImg",src:N(i[t.user_id]).image}),Object(p.jsxs)("span",{className:"card__user",children:["Posted by ",N(i[t.user_id]).name]}),Object(p.jsx)("span",{className:"card__date",children:t.created_at?t.created_at.toDate().toLocaleString():""}),a.id===t.user_id&&Object(p.jsx)("button",{style:{padding:0},className:"btn open-popover","aria-label":"popover menu",onClick:function(){return b(!j)}}),j&&Object(p.jsx)("div",{className:"card__popover",children:Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{onClick:o,children:"Update post"}),Object(p.jsx)("li",{onClick:function(){return s(t.id)},children:"Delete Post"})]})})]}),Object(p.jsx)("h5",{className:"card-title mt-2",children:t.title}),Object(p.jsx)("p",{className:"card-text",children:t.description}),Object(p.jsx)("div",{children:t.url&&y(t.url)&&Object(p.jsx)("img",{style:{width:"100%"},src:t.url})}),t.url&&!y(t.url)&&Object(p.jsx)("a",{href:t.url,target:"_blank",children:t.url})]})})]})})},S=n(8),k=n(20),C=b.firestore(),E=function(e){var t=e.user,n=Object(r.useState)([]),c=Object(d.a)(n,2),s=c[0],a=c[1],i=Object(r.useState)({}),l=Object(d.a)(i,2),j=l[0],m=l[1],f=Object(r.useState)({}),O=Object(d.a)(f,2),N=O[0],y=O[1],E=Object(r.useState)({}),P=Object(d.a)(E,2),T=P[0],U=P[1],F=Object(r.useState)(!1),D=Object(d.a)(F,2),I=D[0],V=D[1],R=Object(r.useState)(""),L=Object(d.a)(R,2),A=L[0],B=L[1],M=Object(S.f)(),X=Object(k.c)((function(e){return e.subreddits.find((function(e){return e.name===M.name}))}));Object(r.useEffect)((function(){if(X){var e=C.collection("posts").where("subreddit_id","==",X.id).orderBy("created_at","desc").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(Object(g.a)(Object(g.a)({},e.data()),{},{id:e.id}))})),a(t)}));return function(){e()}}}),[X]),Object(r.useEffect)(Object(u.a)(o.a.mark((function e(){var t,n,r,c,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.length){e.next=23;break}t=Object(v.a)(new Set(s.map((function(e){return e.user_id})))),n={},r=Object(x.a)(t),e.prev=4,r.s();case 6:if((c=r.n()).done){e.next=14;break}return a=c.value,e.next=10,C.collection("users").doc(a).get();case 10:i=e.sent,n[a]=i.data();case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:y(n);case 23:case"end":return e.stop()}}),e,null,[[4,16,19,22]])}))),[s]);var z=function(){var e=Object(u.a)(o.a.mark((function e(n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={title:n.title,description:n.description,url:n.url,user_id:t.id,subreddit_id:X.id,created_at:b.firestore.FieldValue.serverTimestamp(),updated_at:b.firestore.FieldValue.serverTimestamp()},e.next=3,C.collection("posts").add(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(u.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=C.collection("posts").doc(j.id),e.next=3,n.update(Object(g.a)(Object(g.a)({},t),{},{updated_at:b.firestore.FieldValue.serverTimestamp()}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.collection("posts").doc(t).delete();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(u.a)(o.a.mark((function e(n,r){var c,s,a,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=C.collection("post_votes"),e.next=3,c.doc(n+t.id).get();case 3:if(s=e.sent,"add"!=r){e.next=16;break}if(a={user_id:t.id,post_id:n,subreddit_id:X.id,created_at:b.firestore.FieldValue.serverTimestamp()},s.exists){e.next=15;break}return e.next=9,c.doc(n+t.id).set(a);case 9:return e.next=11,C.collection("post_votes").where("post_id","==",n).get();case 11:i=e.sent,U(Object(g.a)(Object(g.a)({},T),{},Object(h.a)({},n,i.size))),e.next=16;break;case 15:return e.abrupt("return");case 16:if("delete"!=r){e.next=27;break}if(s.exists){e.next=21;break}return e.abrupt("return");case 21:return e.next=23,c.doc(n+t.id).delete();case 23:return e.next=25,C.collection("post_votes").where("post_id","==",n).get();case 25:u=e.sent,U(Object(g.a)(Object(g.a)({},T),{},Object(h.a)({},n,u.size)));case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),J=function(e,t){"update"===e&&m(t),B(e),V(!0)};return Object(p.jsxs)("div",{children:[Object(p.jsx)("h2",{className:"text-muted mb-5",children:M.name.toUpperCase()}),t?Object(p.jsx)(_,{activePost:j,mode:A,onCreatePost:z,onUpdatePost:G,isOpen:I,onOpenForm:function(){return J("create")},onCloseForm:function(){V(!1),m({})}}):Object(p.jsx)("span",{className:"text-muted",children:"Please log in to create a post"}),Object(p.jsx)("section",{className:"mt-5",children:s.map((function(e,n){return Object(p.jsx)(w,{user:t,post:e,vote:T[e.id],onDeletePost:q,onVotePost:H,users:N,onOpenForm:function(){return J("update",e)}},e.id)}))})]})},P=function(e){return{type:"AUTH_SUCCESS",user:e}},T=[],U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SUBREDDITS":return t.subreddits;default:return e}};n(58),n(59);var F=function(){var e=Object(k.c)((function(e){return e.auth.user})),t=Object(k.c)((function(e){return e.subreddits})),n=Object(k.b)();return Object(r.useEffect)((function(){b.auth().onAuthStateChanged(function(){var e=Object(u.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return r={id:t.uid,name:t.displayName,image:t.photoURL,created_at:b.firestore.FieldValue.serverTimestamp()},e.next=4,C.collection("users").doc(r.id).set(r);case 4:n(P(r)),e.next=8;break;case 7:n({type:"LOGOUT"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(r.useEffect)((function(){var e=C.collection("subreddits").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.data())})),n(function(e){return{type:"SET_SUBREDDITS",subreddits:e}}(t))}));return function(){e()}}),[]),Object(p.jsx)("div",{className:"App",children:Object(p.jsx)(m,{user:e,children:Object(p.jsxs)(S.c,{children:[Object(p.jsx)(S.a,{exact:!0,path:"/",children:Object(p.jsx)(f,{})}),Object(p.jsx)(S.a,{path:"/subreddits",render:function(){return Object(p.jsx)(O,{subreddits:t})}}),Object(p.jsx)(S.a,{path:"/r/:name",children:Object(p.jsx)(E,{user:e})})]})})})},D=n(22),I=n(41),V={user:null},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTH_SUCCESS":return{user:t.user};case"LOGOUT":return{user:null};default:return e}},L=(n(60),Object(D.c)({auth:R,subreddits:U})),A=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||D.d,B=Object(D.e)(L,A(Object(D.a)(I.a)));a.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(k.a,{store:B,children:Object(p.jsx)(l.a,{basename:"/reddit-clone",children:Object(p.jsx)(F,{})})})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.62c177d7.chunk.js.map